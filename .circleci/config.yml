# This config was automatically generated from your source code
# Stacks detected: cicd:github-actions:.github/workflows,deps:rust:.
version: 2.1
orbs:
  rust: circleci/rust@1.6.1
jobs:
  build-arm:
    machine:
      image: ubuntu-2204:2023.07.1
    resource_class: arm.medium
    steps:
    - run:
        name: Download Flutter
        command: |
          curl -L -o flutter.tar.gz https://github.com/flutter/flutter/archive/refs/tags/3.24.4.tar.gz
          tar -xzf flutter.tar.gz
    - run:
        name: Set up Flutter
        command: |
          export PATH="$PATH:$HOME/project/flutter/bin"
          flutter doctor
    - run:
        name: Run Flutter setup
        command: |
          flutter --version
    - checkout
    - run:
        name: Install dependencies
        command: |
          sudo apt-get update
          sudo apt-get install liblmdb0 jq alsa-base alsa-source librust-alsa-sys-dev
          libasound2-dev liblmdb-dev clang cmake ninja-build pkg-config libgtk-3-dev
          dpkg-dev
    - run:
        name: Install the Rust dependencies
        command: cargo install "flutter_rust_bridge_codegen" rinf protoc-gen-prost
    - run:
        name: Activate Protobuf
        command: flutter pub global activate protoc_plugin
    - run:
        name: Flutter pub get
        command: flutter pub get
    - run:
        name: Generate message files
        command: rinf message
    - run:
        name: Build linux
        command: flutter build linux --release --verbose
    - store_artifacts:
        path: build/linux/arm64/release/bundle/
  release-linux:
    executor: default_image
    steps:
    - checkout
    - store_artifacts:
        path: artifacts
workflows:
  build:
    jobs:
      - build-arm
